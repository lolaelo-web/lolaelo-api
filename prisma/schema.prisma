generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["extranet"]
}

model PropertyProfile {
  id           Int              @id @default(autoincrement())
  partnerId    Int              @unique
  name         String
  addressLine  String?
  city         String?
  country      String?
  contactEmail String?
  phone        String?
  description  String?
  cityCode     String?
  latitude     Float?
  longitude    Float?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  mapLabel     String?
  partner      extranet_Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@schema("extranet")
}

model extranet_ContentBlock {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@map("ContentBlock")
  @@schema("extranet")
}

model extranet_ExtranetLoginCode {
  id        Int              @id @default(autoincrement())
  partnerId Int
  codeHash  String
  expiresAt DateTime
  createdAt DateTime         @default(now())
  usedAt    DateTime?
  Partner   extranet_Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([partnerId])
  @@map("ExtranetLoginCode")
  @@schema("extranet")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model extranet_Partner {
  id                Int                          @id @default(autoincrement())
  email             String                       @unique
  name              String?
  createdAt         DateTime                     @default(now())
  updatedAt         DateTime
  AddOns            extranet_AddOn[]             @relation("extranet_Partner_AddOns")
  Booking           Booking[]
  ExtranetLoginCode extranet_ExtranetLoginCode[]
  PmsConnection     extranet_PmsConnection[]
  PropertyDocument  extranet_PropertyDocument[]
  PropertyPhoto     extranet_PropertyPhoto[]
  PropertyProfile   PropertyProfile?
  RatePlan          extranet_RatePlan[]
  RoomInventory     extranet_RoomInventory[]
  RoomPrice         extranet_RoomPrice[]
  RoomType          extranet_RoomType[]

  @@map("Partner")
  @@schema("extranet")
}

model extranet_PartnerApplication {
  id          Int      @id @default(autoincrement())
  companyName String
  contactName String
  email       String
  phone       String?
  location    String?
  notes       String?
  createdAt   DateTime @default(now())

  @@map("PartnerApplication")
  @@schema("extranet")
}

model extranet_PmsConnection {
  id             Int                   @id @default(autoincrement())
  partnerId      Int
  provider       String
  mode           String                @default("mock")
  status         String                @default("TESTING")
  scope          String?
  accessToken    String?
  refreshToken   String?
  tokenExpiresAt DateTime?             @db.Timestamptz(6)
  lastSyncAt     DateTime?             @db.Timestamptz(6)
  createdAt      DateTime              @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime              @default(now()) @db.Timestamptz(6)
  Partner        extranet_Partner      @relation(fields: [partnerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  PmsMapping     extranet_PmsMapping[]
  SyncLog        extranet_SyncLog[]

  @@unique([partnerId, provider], map: "PmsConnection_partner_provider_unique")
  @@index([partnerId], map: "PmsConnection_partner_idx")
  @@map("PmsConnection")
  @@schema("extranet")
}

model extranet_PmsMapping {
  id               Int                    @id @default(autoincrement())
  pmsConnectionId  Int
  remoteRoomId     String
  remoteRatePlanId String?
  localRoomTypeId  Int?
  localRatePlanId  Int?
  currency         String?
  active           Boolean                @default(true)
  createdAt        DateTime               @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime               @default(now()) @db.Timestamptz(6)
  RatePlan         extranet_RatePlan?     @relation(fields: [localRatePlanId], references: [id], onUpdate: NoAction)
  RoomType         extranet_RoomType?     @relation(fields: [localRoomTypeId], references: [id], onUpdate: NoAction)
  PmsConnection    extranet_PmsConnection @relation(fields: [pmsConnectionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pmsConnectionId], map: "PmsMapping_conn_idx")
  @@index([remoteRoomId, remoteRatePlanId], map: "PmsMapping_remote_idx")
  @@map("PmsMapping")
  @@schema("extranet")
}

model extranet_PropertyDocument {
  id          Int                     @id @default(autoincrement())
  partnerId   Int
  type        extranet_DocumentType
  key         String                  @unique
  url         String
  fileName    String?
  contentType String?
  status      extranet_DocumentStatus @default(SUBMITTED)
  notes       String?
  expiresAt   DateTime?
  uploadedAt  DateTime                @default(now())
  verifiedAt  DateTime?
  Partner     extranet_Partner        @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, type])
  @@index([partnerId, status])
  @@map("PropertyDocument")
  @@schema("extranet")
}

model extranet_PropertyPhoto {
  id         Int                @id @default(autoincrement())
  partnerId  Int
  key        String             @unique
  url        String
  alt        String?
  sortOrder  Int                @default(0)
  isCover    Boolean            @default(false)
  width      Int?
  height     Int?
  createdAt  DateTime           @default(now())
  roomTypeId Int?
  Partner    extranet_Partner   @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  RoomType   extranet_RoomType? @relation(fields: [roomTypeId], references: [id])

  @@index([partnerId, sortOrder])
  @@index([partnerId, roomTypeId, sortOrder])
  @@map("PropertyPhoto")
  @@schema("extranet")
}

model PropertyProfileAudit {
  id        BigInt   @id @default(autoincrement())
  partnerid Int
  action    String
  oldvalue  Json?
  newvalue  Json?
  ip        String?
  useremail String?
  createdat DateTime @default(now()) @db.Timestamptz(6)

  @@schema("extranet")
}

model extranet_RatePlan {
  id          Int                   @id @default(autoincrement())
  partnerId   Int
  roomTypeId  Int
  name        String
  policy      String?
  priceDelta  Decimal?              @db.Decimal(10, 2)
  createdAt   DateTime              @default(now())
  updatedAt   DateTime
  code        String?
  kind        String?
  value       Decimal?              @db.Decimal
  active      Boolean               @default(true)
  isDefault   Boolean               @default(false)
  Booking     Booking[]
  BookingItem BookingItem[]
  PmsMapping  extranet_PmsMapping[]
  Partner     extranet_Partner      @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  RoomType    extranet_RoomType     @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)
  RoomPrice   extranet_RoomPrice[]

  @@unique([roomTypeId, name])
  @@index([partnerId])
  @@index([partnerId, roomTypeId, code], map: "RatePlan_partner_room_code_idx")
  @@map("RatePlan")
  @@schema("extranet")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model extranet_RoomInventory {
  id         Int               @id @default(autoincrement())
  partnerId  Int
  roomTypeId Int
  date       DateTime
  roomsOpen  Int               @default(0)
  isClosed   Boolean           @default(false)
  minStay    Int?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @default(now())
  Partner    extranet_Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  RoomType   extranet_RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)

  @@unique([roomTypeId, date])
  @@index([partnerId, date])
  @@map("RoomInventory")
  @@schema("extranet")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model extranet_RoomPrice {
  id         Int               @id @default(autoincrement())
  partnerId  Int
  roomTypeId Int
  ratePlanId Int
  date       DateTime
  price      Decimal           @db.Decimal(10, 2)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @default(now())
  Partner    extranet_Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  RatePlan   extranet_RatePlan @relation(fields: [ratePlanId], references: [id], onDelete: Cascade)
  RoomType   extranet_RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)

  @@unique([roomTypeId, date, ratePlanId])
  @@index([partnerId, date])
  @@map("RoomPrice")
  @@schema("extranet")
}

model extranet_RoomType {
  id             Int                      @id @default(autoincrement())
  partnerId      Int
  name           String
  description    String?
  maxGuests      Int                      @default(2)
  basePrice      Decimal                  @db.Decimal(10, 2)
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime
  occupancy      Int?
  code           String?
  active         Boolean                  @default(false)
  summary        String?
  size_sqm       Int?
  size_sqft      Int?
  details_keys   String[]                 @default([])
  details_text   String?
  inclusion_keys String[]                 @default([])
  inclusion_text String?
  Booking        Booking[]
  BookingItem    BookingItem[]
  PmsMapping     extranet_PmsMapping[]
  PropertyPhotos extranet_PropertyPhoto[]
  RatePlan       extranet_RatePlan[]
  RoomInventory  extranet_RoomInventory[]
  RoomPrice      extranet_RoomPrice[]
  Partner        extranet_Partner         @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, name])
  @@index([partnerId])
  @@map("RoomType")
  @@schema("extranet")
}

model extranet_SyncLog {
  id              Int                    @id @default(autoincrement())
  pmsConnectionId Int
  type            String
  status          String
  message         String?
  startedAt       DateTime               @default(now()) @db.Timestamptz(6)
  finishedAt      DateTime?              @db.Timestamptz(6)
  durationMs      Int?                   @default(0)
  createdAt       DateTime               @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime               @default(now()) @db.Timestamptz(6)
  PmsConnection   extranet_PmsConnection @relation(fields: [pmsConnectionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pmsConnectionId, startedAt(sort: Desc)], map: "SyncLog_conn_started_idx")
  @@map("SyncLog")
  @@schema("extranet")
}

model extranet_AddOn {
  id           Int              @id @default(autoincrement())
  partnerId    Int
  activity     String
  uom          String?
  price        Decimal?         @db.Decimal(10, 2)
  notes        String?
  active       Boolean          @default(true)
  sortOrder    Int?
  maxQty       Int?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  Partner      extranet_Partner @relation("extranet_Partner_AddOns", fields: [partnerId], references: [id], onDelete: Cascade)
  BookingAddOn BookingAddOn[]

  @@index([partnerId])
  @@map("AddOn")
  @@schema("extranet")
}

model extranet_Waitlist {
  id        Int      @id @default(autoincrement())
  email     String
  phone     String?
  createdAt DateTime @default(now())

  @@map("Waitlist")
  @@schema("extranet")
}

model WebAnalyticsSession {
  id           String              @id @default(uuid())
  createdAt    DateTime            @default(now())
  lastSeenAt   DateTime            @default(now())
  endedAt      DateTime?
  landingPath  String?
  landingUrl   String?
  referrer     String?
  referrerHost String?
  utmSource    String?
  utmMedium    String?
  utmCampaign  String?
  utmContent   String?
  userAgent    String?
  deviceType   String?
  country      String?
  ipHash       String?
  isBot        Boolean             @default(false)
  events       WebAnalyticsEvent[]

  @@index([createdAt])
  @@index([lastSeenAt])
  @@index([utmSource, utmMedium, utmCampaign])
  @@schema("extranet")
}

model WebAnalyticsEvent {
  id        BigInt              @id @default(autoincrement())
  ts        DateTime            @default(now())
  sessionId String
  name      String
  path      String?
  url       String?
  title     String?
  referrer  String?
  activeMs  Int?
  payload   Json?
  session   WebAnalyticsSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([ts])
  @@index([sessionId, ts])
  @@index([name, ts])
  @@index([path, ts])
  @@schema("extranet")
}

model WebAnalyticsDaily {
  id           String   @id @default(uuid())
  day          DateTime
  utmSource    String?
  utmMedium    String?
  utmCampaign  String?
  referrerHost String?
  landingPath  String?
  sessions     Int      @default(0)
  pageViews    Int      @default(0)
  engagedMs    BigInt   @default(0)

  @@unique([day, utmSource, utmMedium, utmCampaign, referrerHost, landingPath], map: "uniq_web_analytics_daily_dims")
  @@index([day])
  @@schema("extranet")
}

model Booking {
  id                       Int                   @id @default(autoincrement())
  bookingRef               String                @unique
  partnerId                Int
  roomTypeId               Int
  ratePlanId               Int
  checkInDate              DateTime
  checkOutDate             DateTime
  qty                      Int                   @default(1)
  guests                   Int?
  travelerFirstName        String?
  travelerLastName         String?
  travelerEmail            String
  travelerPhone            String?
  currency                 String                @default("PHP")
  amountPaid               Decimal               @db.Decimal(10, 2)
  paymentProvider          PaymentProvider
  providerPaymentId        String
  providerCustomerId       String?
  status                   BookingStatus         @default(PENDING_HOTEL_CONFIRMATION)
  createdAt                DateTime              @default(now())
  updatedAt                DateTime
  pendingConfirmExpiresAt  DateTime
  refundDeadlineAt         DateTime
  confirmedAt              DateTime?
  declinedAt               DateTime?
  expiredAt                DateTime?
  canceledAt               DateTime?
  cancellationReason       String?
  cancellationRefundAmount Decimal?              @db.Decimal(10, 2)
  refundStatus             RefundStatus          @default(NOT_STARTED)
  refundStartedAt          DateTime?
  refundedAt               DateTime?
  providerRefundId         String?
  refundLastError          String?
  refundAttemptCount       Int                   @default(0)
  specialRequests          String?
  completedAt              DateTime?             @db.Timestamptz(6)
  Partner                  extranet_Partner      @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  RatePlan                 extranet_RatePlan     @relation(fields: [ratePlanId], references: [id])
  RoomType                 extranet_RoomType     @relation(fields: [roomTypeId], references: [id])
  BookingAddOn             BookingAddOn[]
  BookingConfirmToken      BookingConfirmToken[]
  BookingEvent             BookingEvent[]
  BookingItem              BookingItem[]
  PayoutBooking            PayoutBooking[]

  @@index([bookingRef])
  @@index([partnerId, createdAt])
  @@index([partnerId, status])
  @@schema("extranet")
}

model BookingAddOn {
  id        Int            @id @default(autoincrement())
  bookingId Int
  addOnId   Int
  activity  String
  uom       String?
  unitPrice Decimal        @default(0) @db.Decimal(10, 2)
  qty       Int            @default(1)
  currency  String         @default("PHP")
  lineTotal Decimal        @default(0) @db.Decimal(10, 2)
  notes     String?
  createdAt DateTime       @default(now()) @db.Timestamp(6)
  AddOn     extranet_AddOn @relation(fields: [addOnId], references: [id], onUpdate: NoAction)
  Booking   Booking        @relation(fields: [bookingId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([bookingId, addOnId])
  @@index([bookingId])
  @@schema("extranet")
}

model BookingConfirmToken {
  id        Int       @id @default(autoincrement())
  bookingId Int
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  Booking   Booking   @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@schema("extranet")
}

model BookingEvent {
  id         Int              @id @default(autoincrement())
  bookingId  Int
  fromStatus BookingStatus?
  toStatus   BookingStatus
  actorType  BookingActorType
  actorId    Int?
  note       String?
  createdAt  DateTime         @default(now())
  Booking    Booking          @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId, createdAt])
  @@schema("extranet")
}

model BookingItem {
  id           Int               @id @default(autoincrement())
  bookingId    Int
  roomTypeId   Int
  ratePlanId   Int
  checkInDate  DateTime
  checkOutDate DateTime
  qty          Int               @default(1)
  currency     String            @default("PHP")
  lineTotal    Decimal           @default(0) @db.Decimal(10, 2)
  createdAt    DateTime          @default(now())
  Booking      Booking           @relation(fields: [bookingId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  RatePlan     extranet_RatePlan @relation(fields: [ratePlanId], references: [id], onUpdate: NoAction)
  RoomType     extranet_RoomType @relation(fields: [roomTypeId], references: [id], onUpdate: NoAction)

  @@index([bookingId])
  @@index([bookingId, roomTypeId])
  @@schema("extranet")
}

model Payout {
  id                 BigInt          @id @default(autoincrement())
  partnerId          Int
  weekStart          DateTime        @db.Date
  weekEnd            DateTime        @db.Date
  currency           String          @default("USD")
  amountNet          Decimal?        @db.Decimal(12, 2)
  method             String?
  confirmationNumber String?
  paidAt             DateTime?       @db.Timestamptz(6)
  status             String          @default("DRAFT")
  createdAt          DateTime        @default(now()) @db.Timestamptz(6)
  createdBy          String?
  PayoutBooking      PayoutBooking[]

  @@index([partnerId, weekStart, weekEnd], map: "Payout_partner_week_idx")
  @@schema("extranet")
}

model PayoutBooking {
  id           BigInt   @id @default(autoincrement())
  payoutId     BigInt
  bookingId    Int
  bookingRef   String?
  propertyName String?
  netAmount    Decimal? @db.Decimal(12, 2)
  createdAt    DateTime @default(now()) @db.Timestamptz(6)
  marginPct    Decimal? @db.Decimal
  feeAmount    Decimal? @db.Decimal
  Booking      Booking  @relation(fields: [bookingId], references: [id], onUpdate: NoAction)
  Payout       Payout   @relation(fields: [payoutId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([payoutId, bookingId])
  @@index([bookingId], map: "PayoutBooking_booking_idx")
  @@schema("extranet")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model prisma_migrations_extranet_legacy_20260110 {
  id                  String?   @db.VarChar(36)
  checksum            String?   @db.VarChar(64)
  finished_at         DateTime? @db.Timestamptz(6)
  migration_name      String?   @db.VarChar(255)
  logs                String?
  rolled_back_at      DateTime? @db.Timestamptz(6)
  started_at          DateTime? @db.Timestamptz(6)
  applied_steps_count Int?

  @@map("_prisma_migrations_extranet_legacy_20260110")
  @@ignore
  @@schema("extranet")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model prisma_migrations_public_legacy_20260110 {
  id                  String?   @db.VarChar(36)
  checksum            String?   @db.VarChar(64)
  finished_at         DateTime? @db.Timestamptz(6)
  migration_name      String?   @db.VarChar(255)
  logs                String?
  rolled_back_at      DateTime? @db.Timestamptz(6)
  started_at          DateTime? @db.Timestamptz(6)
  applied_steps_count Int?

  @@map("_prisma_migrations_public_legacy_20260110")
  @@ignore
  @@schema("extranet")
}

enum extranet_DocumentStatus {
  REQUIRED
  SUBMITTED
  APPROVED
  REJECTED

  @@map("DocumentStatus")
  @@schema("extranet")
}

enum extranet_DocumentType {
  GOVT_ID
  BUSINESS_REG
  TAX_ID
  BANK_PROOF
  PROOF_OF_ADDRESS
  INSURANCE_LIABILITY
  PROPERTY_OWNERSHIP
  LOCAL_LICENSE

  @@map("DocumentType")
  @@schema("extranet")
}

enum BookingActorType {
  SYSTEM
  HOTEL
  TRAVELER
  ADMIN

  @@schema("extranet")
}

enum BookingStatus {
  PENDING_HOTEL_CONFIRMATION
  CONFIRMED
  DECLINED_BY_HOTEL
  EXPIRED_NO_RESPONSE
  CANCELED_BY_TRAVELER
  REFUND_IN_PROGRESS
  REFUNDED
  CHECKED_IN
  COMPLETED

  @@schema("extranet")
}

enum PaymentProvider {
  STRIPE
  PAYPAL

  @@schema("extranet")
}

enum RefundStatus {
  NOT_STARTED
  PROCESSING
  SUCCEEDED
  FAILED

  @@schema("extranet")
}

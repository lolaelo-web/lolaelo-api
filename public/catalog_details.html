<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lolaelo · Stay</title>
  <link rel="icon" href="/logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    /* === ANCHOR: DETAILS_LIGHT_SKIN ======================================= */
    :root{
      --bg:#fff; --fg:#111; --muted:#6b7280; --line:#eaeaea; --bubble:#ff6633;
      --paper:#ffffff; --radius:16px; --shadow:0 12px 40px rgba(0,0,0,.08);
      --maxw:1100px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--fg);
      background:
        linear-gradient(to bottom, rgba(255,255,255,.10), rgba(255,255,255,.10)),
        url("https://images.pexels.com/photos/1005417/pexels-photo-1005417.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=1600&w=2400")
        center/cover no-repeat fixed;
      display:flex; flex-direction:column; align-items:center;
    }

    .paper{ width:100%; max-width:var(--maxw); margin:18px 20px; background:var(--paper);
      border-radius:var(--radius); box-shadow:var(--shadow); padding:16px 16px 22px; }

    header{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .back{ border:1px solid var(--line); background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer; }
    h1{ font-size:clamp(20px,3.2vw,24px); margin:0 0 0 8px; font-weight:600; }

    .layout{ display:grid; grid-template-columns: 1.3fr .9fr; gap:16px; }
    @media (max-width:900px){ .layout{ grid-template-columns: 1fr; } }

    /* Gallery */
    .hero{ width:100%; aspect-ratio: 16/9; background:#000; border-radius:14px; overflow:hidden; }
    .hero img{ width:100%; height:100%; object-fit:cover; display:block; }
    #thumbs{ display:flex; gap:10px; margin:10px 0 6px; }
    .thumb{ width:90px; height:56px; border-radius:10px; overflow:hidden; border:1px solid var(--line);
      cursor:pointer; position:relative; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .thumb.active{ box-shadow:0 0 0 2px var(--bubble); }

    /* Right panel */
    .panel{ border:1px solid var(--line); border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:14px; }
    .muted{ color:var(--muted); font-size:12px; }
    .price{ font-weight:700; font-size:22px; }
    .book{ border:1px solid var(--bubble); background:var(--bubble); color:#fff; font-weight:700;
      border-radius:12px; padding:14px; width:100%; cursor:pointer; }

    /* Chips + table */
    .chips{ display:flex; gap:6px; flex-wrap:wrap; margin:10px 0; }
    .chip{ font-size:11px; padding:4px 8px; border:1px solid var(--line); border-radius:999px; background:#fafafa; color:#444; }

    table{ width:100%; border-collapse:separate; border-spacing:0; margin-top:10px; }
    thead th{ text-align:left; font-size:12px; color:var(--muted); padding:8px; border-bottom:1px solid var(--line); }
    tbody td{ padding:10px 8px; border-bottom:1px solid var(--line); font-variant-numeric:tabular-nums; }
    .tag{ padding:4px 8px; border-radius:999px; background:#ecfdf5; color:#047857; font-size:12px; border:1px solid #d1fae5; display:inline-block; }
    .tag.off{ background:#fef2f2; color:#b91c1c; border-color:#fee2e2; }
  </style>
</head>
<body>
  <div class="paper">
    <header>
      <a class="back" href="/catalog">← Back</a>
      <h1 id="prop-name">Loading…</h1>
    </header>

    <div class="layout">
      <section>
        <div id="hero" class="hero" aria-live="polite">
          <img id="hero-img" src="" alt="">
        </div>
        <div id="thumbs" aria-label="Gallery thumbnails"></div>

        <div class="chips" id="amenities"></div>

        <table aria-label="Availability and prices">
          <thead><tr>
            <th style="width:120px;">Date</th>
            <th style="width:60px;">Open</th>
            <th style="width:100px;">Price</th>
            <th style="width:80px;">MinStay</th>
            <th style="width:80px;">Status</th>
          </tr></thead>
          <tbody id="rows"></tbody>
        </table>
      </section>

      <aside class="panel">
        <div class="muted" id="stay-range"></div>
        <div class="muted">From</div>
        <div class="price" id="from"></div>
        <div class="muted" id="nights-note"></div>
        <button class="book" type="button" id="book">Book now (mock)</button>
        <div class="muted" id="copyLink" style="text-align:center; cursor:pointer;">Copy link</div>
      </aside>
    </div>
  </div>

  <script>
    // === ANCHOR: DETAILS_SCRIPT ============================================
    const qs = new URLSearchParams(location.search);
    const propertyId = qs.get('propertyId');
    const start = qs.get('start') || new Date().toISOString().slice(0,10);
    const end   = qs.get('end')   || start;

    const hero = document.getElementById('hero-img');
    const thumbs = document.getElementById('thumbs');
    const rows = document.getElementById('rows');
    const fromEl = document.getElementById('from');
    const rangeEl = document.getElementById('stay-range');
    const nameEl = document.getElementById('prop-name');
    const amenities = document.getElementById('amenities');
    const nightsNote = document.getElementById('nights-note');

    let images = [];
    let heroIndex = 0;

    function setHero(i){
      if (!images.length) return;
      i = Math.max(0, Math.min(images.length-1, i));
      heroIndex = i;
      const src = images[i];
      const img = new Image();
      img.onload = ()=>{ hero.src = src; hero.alt = nameEl.textContent || 'Photo'; };
      img.src = src;

      thumbs.querySelectorAll('.thumb').forEach((t,idx)=>{
        t.classList.toggle('active', idx===i);
        t.setAttribute('aria-selected', idx===i ? 'true' : 'false');
      });
    }

    function thumbHTML(src, idx){
      return `<button class="thumb" type="button" data-idx="${idx}" aria-label="Photo ${idx+1}" aria-selected="false">
        <img src="${src}" alt="">
      </button>`;
    }

    function money(v){ const n=Number(v); return Number.isFinite(n) ? `$${n.toFixed(2)}` : '—'; }

    async function load(){
      const r = await fetch(`/catalog/details?propertyId=${encodeURIComponent(propertyId)}&start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`);
      const j = await r.json();

      nameEl.textContent = j?.meta?.property?.name || 'Stay';
      rangeEl.textContent = `${start} — ${end}`;
      fromEl.textContent = money(j?.rooms?.[0]?.fromPrice);
      nightsNote.textContent = `${j?.rooms?.[0]?.availableNights ?? 0}/${j?.rooms?.[0]?.nightsTotal ?? 0} nights available`;

      images = j?.rooms?.[0]?.images?.length ? j.rooms[0].images : (j?.meta?.property?.images || []);
      amenities.innerHTML = (j?.meta?.property?.amenities || []).slice(0,6).map(a=>`<span class="chip">${a}</span>`).join("");

      // gallery
      thumbs.innerHTML = images.map((src, i)=>thumbHTML(src, i)).join("");
      setHero(0);

      // CLICK + HOVER to swap hero
      thumbs.addEventListener('click', (e)=>{
        const b = e.target.closest('.thumb'); if(!b) return;
        setHero(Number(b.dataset.idx||'0'));
      });
      thumbs.addEventListener('mouseover', (e)=>{
        const b = e.target.closest('.thumb'); if(!b) return;
        setHero(Number(b.dataset.idx||'0'));
      });

      // table rows
      const daily = j?.rooms?.[0]?.daily || [];
      rows.innerHTML = daily.map(d=>{
        const tag = d.closed ? `<span class="tag off">Closed</span>` : `<span class="tag">Open</span>`;
        return `<tr>
          <td>${d.date}</td>
          <td>${d.open}</td>
          <td>${money(d.price)}</td>
          <td>${d.minStay ?? 1}</td>
          <td>${tag}</td>
        </tr>`;
      }).join("");
    }

    document.getElementById('book').addEventListener('click', ()=>{
      alert('Booking flows are coming soon. For now, this is a design preview using mock data.');
    });
    document.getElementById('copyLink').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(location.href); alert('Link copied'); }catch(_){}
    });

    load().catch(err=>{ console.error(err); alert('Failed to load details'); });
  </script>
</body>
</html>

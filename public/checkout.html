<!DOCTYPE html>
<html lang="en">
<head>
	<link
		rel="icon"
		type="image/png"
		sizes="32x32"
		href="https://www.lolaelo.com/logo2.png?cb=favicon-32"
	/>
	<link
		rel="icon"
		type="image/png"
		sizes="16x16"
		href="https://www.lolaelo.com/logo2.png?cb=favicon-16"
	/>
	<link
		rel="shortcut icon"
		href="https://www.lolaelo.com/logo2.png?cb=favicon"
	/>
  <meta charset="UTF-8" />
  <title>Lolaelo - Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* === ANCHOR: DETAILS_LIGHT_SKIN ======================================= */
    :root{
      --bg:#ffffff;
      --fg:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#064e3b;          /* deep teal, matches index/catalog */
      --bubble:#ff6a3d;         /* orange accent for CTAs */
      --paper:#ffffff;
      --radius:20px;
      --shadow:0 12px 40px rgba(15,23,42,.10);
      --maxw:900px;             /* slightly tighter than catalog */
      /* ANCHOR: TYPO_BASE_VAR */ --body:11px;   /* ~80% of 15px */

      /* extra tokens used in this file */
      --accent: var(--bubble);
      --border-subtle:#e5e7eb;
      --surface-subtle:#f9fafb;
      --border-soft:#e5e7eb;
      --border:#e5e7eb;
      --panel:#f9fafb;
      --surface:#ffffff;
    }

    *{ box-sizing:border-box; }
    /* ANCHOR: FONT_STACK_UNIFY */
    html, body,
    h1, h2, h3, h4, h5, h6,
    p, li, a, span, strong, em,
    table, thead, tbody, tfoot, tr, th, td, caption,
    input, button, select, textarea, label, small, code, pre {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* ANCHOR: PAGE_SCROLL_FIX */
    html,body{ min-height:100%; margin:0; }
    body{
      font: var(--body)/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--fg);
      background:#f3f4f6; /* same neutral backdrop as catalog.html */
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    /* ANCHOR: DETAILS_TYPE_SCALE */
    html { font-size: 16px; }  /* baseline */
    body { font-size: 15px; line-height: 1.5; }

    h1 { font-size: clamp(30px, 4.8vw, 44px); line-height: 1.15; margin: 6px 0 10px; font-weight: 600; }
    h2 { font-size: clamp(18px, 2.4vw, 22px); line-height: 1.2; margin: 10px 0 8px; font-weight: 600; }

    p, li, .meta, .tag, .desc, .smalltext { font-size: 15px; }
    .small { font-size: 13px; color: var(--muted); }

    /* ANCHOR: A11Y_VISUALLY_HIDDEN */
    .visually-hidden{
      position:absolute !important;
      width:1px !important;
      height:1px !important;
      padding:0 !important;
      margin:-1px !important;
      overflow:hidden !important;
      clip:rect(0,0,0,0) !important;
      white-space:nowrap !important;
      border:0 !important;
    }

    /* ANCHOR: TYPO_REGULAR_ELEMS */
    p, li, td, th, input, select, button, .meta, .note { font-size: var(--body); }

    /* ANCHOR: DETAILS_PAPER_CLIP */
    .paper{
      width: 100%;
      max-width: var(--maxw);
      margin: 24px 20px;
      background: var(--paper);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px 22px 28px;
      overflow: hidden;
    }

    /* ANCHOR: TOAST_CSS */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: #111;
      color: #fff;
      font-size: 12px;
      padding: 10px 14px;
      border-radius: 999px;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      opacity: 0;
      pointer-events: none;
      transition: opacity .15s ease, transform .15s ease;
      z-index: 1000;
    }
    .toast.show{
      opacity: 0.95;
      transform: translateX(-50%) translateY(-2px);
    }

    .hero-block{
      margin-top: 6px;
      margin-bottom: 18px;
    }

    /* ANCHOR: SCROLLTOP_CSS */
    .scrolltop-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--bubble);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 1100;
    }
    .scrolltop-btn.show { display: flex; }

    /* ANCHOR: DETAILS_TOPBAR_CSS */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;  /* pushes title block to the right */
      padding:12px 16px 8px;
      border-bottom:1px solid var(--line);
    }

    .topbar .logo{
      display:inline-flex;
      align-items:center;
    }
    .topbar .logo img{
      height: 30px;          /* match checkout / other pages */
      width:auto;
      display:block;
    }
    .topbar .title{
      font-size:14px;
      line-height:1.3;
      font-weight:600;
      color:var(--fg);
    }
    .topbar .title > span{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:6px;
    }
    .stay-range{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    /* === SECTION HEADER + DATE CARD (CHECKOUT) ============================ */

    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
    }

    .card-header-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
    }

    .card-header-actions{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:2px;
    }

    .card-header-link{
      border:none;
      background:none;
      padding:0;
      font-size:12px;
      font-weight:500;
      color:var(--accent);
      cursor:pointer;
      text-decoration:none;
    }
    .card-header-link:hover{
      text-decoration:underline;
    }

    .checkout-dates-card-wrapper{
      margin-top:4px;
      display:none;          /* toggled by JS */
    }

    /* ANCHOR: DETAILS_DATE_BAR_CSS â€“ used for the checkout date card */
    .detail-date-bar{
      display:grid;
      grid-template-columns:1fr;  /* vertical: one column */
      row-gap:8px;

      margin-top:2px;
      font-size:12px;

      width:50%;                  /* narrower bubble */
      max-width:260px;
      padding:12px 14px;
      border-radius:18px;
      background:#ffffff;
      border:1px solid var(--line);
      box-shadow:0 4px 12px rgba(15,23,42,0.05);
      box-sizing:border-box;
    }

    .detail-date-bar label{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .detail-date-bar label span{
      font-size:11px;
      color:var(--muted);
    }
    .detail-date-bar input[type="date"]{
      font-size:12px;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--border-subtle);
      background:var(--surface-subtle);
      color:var(--fg);
    }
    .detail-date-bar button{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--accent);
      background:transparent;
      font-size:12px;
      font-weight:500;
      cursor:pointer;
      white-space:nowrap;

      grid-column:1 / -1;      /* third row */
      justify-self:flex-end;   /* right aligned */
    }

    /* ANCHOR: DETAILS_LAYOUT_COLS */
    .layout{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
      align-items:start;
    }

    /* Keep two columns; collapse only below ~840px */
    @media (max-width:840px){
      .layout{ grid-template-columns: 1fr; }
    }

    /* ANCHOR: ROOMCAT_LIST_CSS */
    .roomcats { display: grid; gap: 10px; margin: 12px 0; }
    .roomcat {
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      display: grid;
      grid-template-columns: 30px 100px 1fr auto;
      gap: 14px;
      align-items: center;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(15,23,42,0.05); /* subtle like catalog */
    }
    .roomcat h3 {
      margin: 0 0 2px 0;
      font-size: 14px;
      font-weight: 600;
    }
    .roomcat .meta {
      font-size: 13px;
      color: var(--muted);
    }
    .roomcat img {
      width: 100px;
      height: 72px;
      object-fit: cover;
      border-radius: 14px;
      background: #f3f4f6;
      display: block;
    }
    .roomcat .btn-select {
      background: var(--bubble);
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      box-shadow: 0 2px 4px rgba(15,23,42,0.10);
    }

    .roomcat-plan-btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
      padding: 7px 18px;
      border-radius: 999px;
      border: 1px solid #14b8a6; /* teal outline */
      background:
        linear-gradient(135deg,
          rgba(34,211,238,0.06),
          rgba(16,185,129,0.12));
      color: #0f766e;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      box-shadow:
        0 0 0 1px rgba(20,184,166,0.20),
        0 4px 12px rgba(15,23,42,0.08);
    }

    .roomcat-plan-btn:hover{
      box-shadow:
        0 0 0 1px rgba(20,184,166,0.35),
        0 6px 16px rgba(15,23,42,0.12);
      transform: translateY(-0.5px);
    }

    .roomcat-plan-btn:active{
      transform: translateY(1px);
    }

    @media (max-width: 840px){
      .roomcat{ grid-template-columns: 30px 72px 1fr; } /* + | thumb | text */
      .roomcat .btn-select{ grid-column: 1 / -1; justify-self: start; }
    }
    /* ANCHOR: ROOM_MODAL_CSS */
    .room-modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1200;
    }
    .room-modal-backdrop.is-open{
      display: flex;
    }

    .room-modal{
      position: relative;
      background: #fff;
      border-radius: 20px;
      /* wider, almost full-screen but with a small side margin */
      width: min(95vw, 1100px);
      max-height: 92vh;
      box-shadow: 0 24px 60px rgba(15,23,42,0.40);
      overflow: hidden;             /* keep rounded corners */
      display: flex;
      flex-direction: column;
    }

    .room-modal-close{
      position: absolute;
      top: 10px;
      right: 16px;
      border-radius: 999px;
      padding: 4px 14px;
      border: 1px solid rgba(148,163,184,0.55);
      background: linear-gradient(135deg, #ffffff, #f3f4f6);
      color: #111827;
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,23,42,0.25);
    }

    .room-modal-body{
      display: grid;
      /* approx 40% for hero block, 60% for details + plans */
      grid-template-rows: auto minmax(180px, 2fr) minmax(240px, 3fr);
      gap: 12px;
      padding: 18px 18px 20px;
      overflow-y: auto;   /* allow vertical scroll so thumbs + plans are always reachable */
      min-height: 0;      /* required for scrollable grid inside flex parent */
    }

    .room-modal-top{
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .room-modal-top h2{
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .room-modal-hero{
      display: grid;
      grid-template-rows: minmax(180px, 1fr) auto;
      gap: 8px;
    }
    .room-modal-hero-main{
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--line);
      background: #000; /* darker so letterboxing looks intentional */
      cursor: zoom-in;
    }
    .room-modal-hero-main img{
      width: 100%;
      height: 100%;
      object-fit: cover;   /* default = cropped, strong visual */
      display: block;
      transition: object-fit 0.2s ease;
    }
    .room-modal-hero-main:hover img{
      object-fit: contain; /* on hover = show full image, â€œfit to screenâ€ inside hero */
    }

    .room-modal-thumbs{
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 2px;
    }
    .room-modal-thumbs button{
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 0;
      margin: 0;
      background: #fff;
      cursor: pointer;
      flex: 0 0 auto;
    }
    .room-modal-thumbs img{
      display: block;
      width: 96px;
      height: 64px;
      object-fit: cover;
      border-radius: 10px;
    }
    .room-modal-thumbs button[aria-current="true"]{
      border-color: var(--bubble);
      box-shadow: 0 0 0 2px rgba(255,106,61,0.25) inset;
    }

    .room-modal-plans{
      border-top: 1px solid #f3f4f6;
      padding-top: 10px;
      margin-top: 8px;
    }

    .room-modal-subtitle{
      margin: 0 0 4px 0;
      font-size: 14px;
      font-weight: 600;
    }

    /* Inner container that actually holds the pills */
    #roomModalPlans{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: stretch;
      justify-content: center;  /* center the three bubbles */
    }

    /* Horizontal plan pills */
    .room-modal-plan-pill{
      flex: 1 1 0;
      min-width: 225px;    /* widened */
      max-width: 325px;    /* widened */
      padding: 14px 16px;  /* slightly more padding since wider */
      border-radius: 14px;
      border: 1px dashed var(--line);
      background: #fafafa;
      display: flex;
      flex-direction: column;
      align-items: center;     /* center content */
      justify-content: space-between; /* aligns all Select buttons */
      text-align: center;
      gap: 6px;
    }

    .room-modal-plan-pill-title{
      font-size: 15px;
      font-weight: 600;
      text-align: center;
    }

    .room-modal-plan-pill-desc{
      font-size: 13px;
      color: var(--muted);
      text-align: center;
    }

    /* Teal outline â€œBook nowâ€ button inside plan pills */
    .room-modal-plan-pill-btn{
      margin-top: 6px;
      padding: 7px 20px;
      border-radius: 999px;
      border: 1px solid #14b8a6; /* teal outline */
      background: linear-gradient(
        135deg,
        #ffffff 0%,
        #f4fffc 55%,
        #eafff7 100%
      );
      color: #0f766e;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 0 1px rgba(20,184,166,0.25),
        0 6px 16px rgba(15,23,42,0.08);
      transition:
        transform 0.08s ease,
        box-shadow 0.08s ease,
        opacity 0.08s ease;
    }

    .room-modal-plan-pill-btn:hover{
      box-shadow:
        0 0 0 1px rgba(20,184,166,0.35),
        0 8px 20px rgba(15,23,42,0.14);
      transform: translateY(-0.5px);
      opacity: 0.98;
    }

    .room-modal-plan-pill-btn:active{
      transform: translateY(1px);
      box-shadow:
        0 0 0 1px rgba(20,184,166,0.35),
        0 4px 10px rgba(15,23,42,0.18);
      opacity: 0.92;
    }

    /* Slightly larger body text inside the modal only */
    .room-modal-body .small,
    .room-modal-body .muted,
    .room-modal-body li{
      font-size: 14px;
    }

    @media (max-width: 640px){
      .room-modal-body{
        padding: 14px 14px 16px;
        grid-template-rows: auto minmax(150px, 2fr) minmax(200px, 3fr);
      }
    }

    /* ANCHOR: ROOM_MODAL_LIGHTBOX_CSS */
    .room-modal-lightbox {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .room-modal-lightbox.is-open {
      display: flex;
    }

    .room-modal-lightbox-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(2px);
    }

    .room-modal-lightbox-inner {
      position: relative;
      z-index: 1000;
      max-width: 92%;
      max-height: 92%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .room-modal-lightbox-img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.35);
      object-fit: contain;
      background: #000;
    }

    .room-modal-lightbox-close {
      position: absolute;
      top: 12px;
      right: 16px;
      border-radius: 999px;
      padding: 4px 14px;
      border: 1px solid rgba(148,163,184,0.55);
      background: linear-gradient(135deg, #ffffff, #f3f4f6);
      color: #111827;
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      cursor: pointer;
      z-index: 1100;
      box-shadow: 0 2px 8px rgba(15,23,42,0.25);
    }

    .room-modal-lightbox-prev,
    .room-modal-lightbox-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 38px;
      border: none;
      background: none;
      color: #ffffff;
      cursor: pointer;
      z-index: 1100;
      padding: 8px 12px;
      user-select: none;
    }

    .room-modal-lightbox-prev { left: -46px; }
    .room-modal-lightbox-next { right: -46px; }

    @media (max-width: 640px) {
      .room-modal-lightbox-prev { left: 6px; }
      .room-modal-lightbox-next { right: 6px; }
    }

    /* ANCHOR: ROOMCAT_PLANS_CSS */
    .roomcat .toggle {
      appearance: none;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 8px;
      width: 30px; height: 30px;
      display: inline-flex; align-items: center; justify-content: center;
      cursor: pointer; font-weight: 700;
    }
    .roomcat .toggle[aria-expanded="true"] { background: #fff0ea; border-color: #ffd3c2; color: #c2410c; }

    .planlist{
      grid-column: 1 / -1;
      margin-top: 8px;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
      transition:
        max-height .28s ease,
        opacity .20s ease,
        visibility 0s linear .28s;
    }
    .planlist.open{
      max-height: 800px;
      opacity: 1;
      visibility: visible;
      transition:
        max-height .32s ease,
        opacity .20s ease,
        visibility 0s;
    }

    @media (prefers-reduced-motion: reduce){
      .planlist, .planlist.open{
        transition: none !important;
      }
    }

    .planrow{
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px dashed var(--line);
      border-radius: 10px;
      background: #fafafa;
      margin-bottom: 8px;
    }
    .planrow .planname{
      font-weight: 600;
      font-size: 14px;
    }
    .planrow .meta{
      font-size: 12px;
      color: var(--muted);
    }
    .planrow .btn-select {
      border: 1px solid var(--bubble); background: var(--bubble); color: #fff;
      padding: 6px 10px; border-radius: 10px; font-weight: 700; cursor: pointer;
      text-decoration: none; display: inline-block;
    }

    @media (min-width:900px){
      .panel{
        position: sticky;
        top: 12px;
        align-self: start;
      }
    }

    .muted{
      color: var(--muted);
      font-size: 13px;
    }

    /* ANCHOR: DETAILS_PRICE_SIZE */
    .price{
      font-weight: 600;
      font-size: 24px;
      letter-spacing: .1px;
    }
    @media (min-width:1200px){
      .price{ font-size:26px; }
    }

    .book{
      border:1px solid var(--bubble); background:var(--bubble); color:#fff; font-weight:700;
      border-radius:12px; padding:14px; width:100%; cursor:pointer;
    }

    .chips{ display:flex; gap:6px; flex-wrap:wrap; margin:10px 0; }
    .chip{ font-size:11px; padding:4px 8px; border:1px solid var(--line); border-radius:999px; background:#fafafa; color:#444; }

    /* ANCHOR: DETAILS_TAGS */
    .tag{
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      display:inline-block;
      border:1px solid transparent;
      font-weight:600;
    }
    .tag{ background:#dcfce7; color:#166534; border-color:#86efac; }
    .tag.off{ background:#fee2e2; color:#991b1b; border-color:#fca5a5; }

    /* ANCHOR: NUMERIC_UNIFY */
    .price,
    #from,
    .meta,
    .chip {
      font-variant-numeric: tabular-nums lining-nums;
    }

    /* ANCHOR: DETAILS_GALLERY_CSS */
    .hero{
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      background:#f3f4f6;
      aspect-ratio: 16 / 9;
      width: 100%;
      min-height: 260px;
      max-height: 70vh;
      box-shadow: 0 16px 38px rgba(15,23,42,0.18);
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center;
      display:block;
      opacity: 1;
      transition: opacity .25s ease;
      background:#e5e7eb;
    }

    .hero img, .thumbs img{ user-select: none; -webkit-user-drag: none; }

    @media (prefers-reduced-motion: reduce){
      .hero img{ transition: none !important; }
      .hero-nav{ transition: none !important; }
    }

    .hero-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #hero-prev { left: 10px; }
    #hero-next { right: 10px; }
    .hero-nav:hover { background: rgba(255,255,255,0.95); }
    .hero-nav[disabled]{ opacity: .45; cursor: default; box-shadow: none; }
    .hero-nav.is-hidden{ display: none; }
    .hero img.is-fading{ opacity: 0; }

    .thumbs{
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: max-content;
      gap: 10px;
      margin: 12px 0 10px;
      padding: 6px 2px;
      overflow-x: auto;
      scrollbar-gutter: stable;
    }
    .thumbs button{
      appearance: none;
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      background: #ffffff;
      padding: 0;
      margin: 0;
      line-height: 0;
      cursor: pointer;
      box-shadow: none;
      transition: border-color .12s ease, transform .12s ease;
    }
    .thumbs button:hover{
      border-color: #9ca3af;
      transform: translateY(-1px);
    }
    .thumbs img{
      display: block;
      width: 110px;
      height: 72px;
      object-fit: cover;
      background:#f3f4f6;
      border-radius: 14px;
    }
    .thumbs button:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(0,0,0,.12); }
    .thumbs button:focus-visible{ outline: 2px solid var(--bubble); outline-offset: 2px; }
    .thumbs button[aria-current="true"]{ border-color: var(--bubble); box-shadow: 0 0 0 2px rgba(255,102,51,.25) inset; }

    /* ANCHOR: SKELETON_CSS */
    @keyframes shimmer {
      0% { background-position: -400px 0; }
      100% { background-position: 400px 0; }
    }
    .skeleton-bar{
      height: 12px;
      border-radius: 8px;
      background: #f3f4f6;
      background-image: linear-gradient(90deg, #f3f4f6 0px, #e5e7eb 40px, #f3f4f6 80px);
      background-size: 400px 100%;
      animation: shimmer 1.1s infinite linear;
    }
    .hero.is-loading::after{
      content: "";
      position: absolute; inset: 0;
      background-image: linear-gradient(90deg, rgba(0,0,0,0.02) 0%, rgba(0,0,0,0.06) 20%, rgba(0,0,0,0.02) 40%);
      background-size: 400px 100%;
      animation: shimmer 1.1s infinite linear;
    }

    .book,
    .roomcat .btn-select,
    .planrow .btn-select{
      border: none;
      background: var(--bubble);
      color: #fff;
      font-weight: 600;
      border-radius: 999px;
      padding: 10px 16px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 4px 12px rgba(255,106,61,0.25);
      transition:
        filter .15s ease-out,
        box-shadow .15s ease-out,
        transform .12s ease-out;
    }

    .book:hover,
    .roomcat .btn-select:hover,
    .planrow .btn-select:hover{
      filter: brightness(.96);
      box-shadow: 0 6px 18px rgba(255,106,61,0.35);
      transform: translateY(-1px);
    }

    /* ANCHOR: DETAILS_SUMMARY_CSS */
    .summary{
      margin: 12px 16px 4px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--panel);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px 16px;
    }

    .summary-main{
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1 1 auto;
      min-width: 0;
    }

    .summary-price-line{
      display: flex;
      align-items: baseline;
      gap: 6px;
      flex-wrap: wrap;
    }

    .summary-label{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
    }

    .summary .price{
      font-size: 18px;
      font-weight: 600;
    }

    #nights-note{
      font-size: 12px;
      color: var(--muted);
    }

    .summary-location{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .summary-desc{
      margin-top: 4px;
      font-size: 13px;
      line-height: 1.4;
      color: var(--fg);
      max-height: 4.2em;
      overflow: hidden;
    }

    .summary .chips{
      margin-top: 4px;
      flex-wrap: wrap;
      row-gap: 6px;
    }

    .dialog{
      width: min(760px, calc(100vw - 24px));
      max-width: 840px;
    }

    .ri-details-grid,
    .ri-inclusions-grid{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 12px;
      margin-bottom: 6px;
    }

    @media (min-width: 1024px){
      .ri-details-grid,
      .ri-inclusions-grid{
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    #edit-room-summary,
    #edit-room-details,
    #edit-room-inclusions{
      width: 100%;
      resize: vertical;
      min-height: 60px;
    }

    /* ANCHOR: DETAILS_SUMMARY_ICONS_CSS */
    .summary-actions{
      display:grid;
      grid-template-columns: 15% 15% 15% 44%;
      column-gap:24px;
      align-items:flex-start;
      margin-bottom:4px;
      width:100%;
    }

    .summary-icon-wrap{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      text-align:center;
    }

    .summary-icon-btn{
      width:58px;
      height:58px;
      border-radius:999px;
      border:1px solid var(--border-subtle);
      background:var(--surface-subtle);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:34px;
      cursor:pointer;
    }

    .summary-bubble{
      position:absolute;
      top:115%;
      left:50%;
      transform:translateX(-50%);
      z-index:30;
      min-width:220px;
      max-width:320px;
      padding:12px 14px;
      border-radius:14px;
      background:#E6F7F9;
      color:#0F1C2E;
      box-shadow:0 10px 30px rgba(15,23,42,0.12);
      font-size:13px;
      line-height:1.45;
      display:none;
    }
    .summary-bubble strong{
      display:block;
      margin-bottom:6px;
      font-size:13px;
      color:#0F1C2E;
    }
    .summary-icon-wrap:hover .summary-bubble{
      display:block;
    }

    .summary-icon-label{
      margin-top:6px;
      font-size:12px;
      font-weight:500;
      color:#0F1C2E;
      text-align:center;
      width:100%;
    }

    .summary-dates{
      display:flex;
      flex-direction:column;
      gap:4px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#ffffff;
      box-shadow:0 4px 12px rgba(15,23,42,0.05);
      width:100%;
      max-width:100%;
      box-sizing:border-box;
    }

    .summary-nights{
      font-size:11px;
      color:var(--muted);
    }

    @media (max-width: 640px){
      .summary-actions{
        flex-wrap:wrap;
      }
      .summary-actions > .summary-icon-wrap,
      .summary-actions > .summary-dates{
        flex:1 1 45%;
        min-width:140px;
      }
    }

    @media (max-width: 640px){
      .summary-bubble{
        left:auto;
        right:0;
      }
    }

    /* ANCHOR: DETAILS_MAP_MODAL_CSS */
    .details-map-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:60;
    }
    .details-map-backdrop.is-open{
      display:flex;
    }
    .details-map-inner{
      width:min(900px,94vw);
      height:min(540px,80vh);
      background:#ffffff;
      border-radius:18px;
      box-shadow:0 20px 60px rgba(15,23,42,0.35);
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .details-map-header{
      padding:10px 14px;
      font-size:13px;
      font-weight:600;
      border-bottom:1px solid rgba(148,163,184,0.35);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .details-map-close{
      border:none;
      border-radius:999px;
      padding:4px 10px;
      font-size:12px;
      cursor:pointer;
      background:rgba(15,23,42,0.06);
    }
    .details-map-frame{
      flex:1;
      width:100%;
      border:0;
    }

  </style>

</head>
<body>
  <div class="page">
		<header>
			<div class="checkout-header-wrapper" style="
				display:flex;
				align-items:center;
				justify-content:space-between;
				padding:16px 24px;
				border-bottom:1px solid var(--border);
				background:#ffffff;
			">
				
				<!-- LEFT: LOGO -->
				<div style="display:flex;align-items:center;gap:10px;">
					<a href="https://www.lolaelo.com/">
						<img
							src="https://www.lolaelo.com/logo.png?cb=logo-5x"
							alt="Lolaelo"
							decoding="async"
							loading="eager"
							style="display:block;height:24px;width:auto;"
						>
					</a>
				</div>

				<!-- CENTER: CHECKOUT TITLE -->
				<div style="
					flex:1;
					display:flex;
					justify-content:center;
					pointer-events:none;
					margin-left:-48px; /* counter logo width for true center */
				">
					<span style="
						font-size:20px;
						font-weight:600;
						color:#ff6a3d;
						letter-spacing:0.4px;
					">
						CHECKOUT
					</span>
				</div>

				<!-- RIGHT: STEP INDICATOR -->
				<div class="step-indicator" style="font-size:13px;color:var(--muted);white-space:nowrap;">
					Step 1 of 2 Â· Review and details
				</div>

			</div>
		</header>
    <main>
      <div class="layout">
        <!-- Left side: progressive sections -->
        <div>
          <!-- Section 1 - Property and room -->
          <div class="card" data-section="1">
            <div class="card-header">
              <div class="card-title">
                <div class="card-step active" data-step-indicator="1">1</div>
                Property and room
              </div>
              <div class="card-status" data-step-status="1">
                Waiting for confirmation
              </div>
            </div>
            <div class="section-body" data-section-body="1">
            <div class="field-row">
              <div class="field-label">Property name</div>
              <div class="field-value">
                <div id="propertyName"></div>
                <div class="muted" id="propertyMeta"></div>
                <span id="propertyIdValue" style="display:none;"></span>
              </div>
            </div>
              <div class="field-row">
                <div class="field-label">Room</div>
                <div class="field-value">
                  <div id="roomName"></div>
                  <span id="roomIdValue" style="display:none;"></span>
                </div>
              </div>
              <div class="field-row">
                <div class="field-label">Rate plan</div>
                <div class="field-value">
                  <div id="ratePlanName"></div>
                  <span id="ratePlanIdValue" style="display:none;"></span>
                </div>
              </div>
              <div class="field-inline">
                <button class="btn-link" id="changePlanLink" type="button">
                  Change room or rate plan
                </button>
              </div>
              <button class="btn-primary" type="button" data-confirm="1">
                Confirm room
              </button>
            </div>
          </div>

          <!-- Section 2 - Dates and pricing -->
          <div class="card" data-section="2">
            <div class="card-header">
              <div class="card-title">
                <div class="card-step" data-step-indicator="2">2</div>
                Dates and pricing
              </div>

              <!-- RIGHT SIDE: status + edit + date card stacked -->
              <div class="card-header-right">
                <div class="card-header-actions">
                  <div class="card-status" data-step-status="2">
                    Locked until previous step
                  </div>
                  <button
                    class="card-header-link"
                    id="editDatesLink"
                    type="button"
                  >
                    Edit dates
                  </button>
                </div>

                <div
                  id="checkoutDatesCardWrapper"
                  class="checkout-dates-card-wrapper"
                >
                  <div id="checkout-date-bar" class="detail-date-bar">
                    <label class="detail-date-field">
                      <span>Check in</span>
                      <input type="date" id="checkout-checkin" />
                    </label>
                    <label class="detail-date-field">
                      <span>Check out</span>
                      <input type="date" id="checkout-checkout" />
                    </label>
                    <button type="button" id="checkout-dates-apply">
                      Update dates
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="section-body hidden" data-section-body="2">
              <div class="field-row">
                <div class="field-label">Stay dates</div>
                <div class="field-value" id="stayDatesText">Dates from URL</div>
              </div>

              <div class="field-row">
                <div class="field-label">Nights</div>
                <div class="field-value" id="nightsCountText">n nights</div>
              </div>

              <div class="field-row">
                <div class="field-label">Price per night</div>
                <div class="field-value" id="nightlyPriceText">-</div>
              </div>

              <button class="btn-primary" type="button" data-confirm="2">
                Confirm dates and price
              </button>
            </div>
          </div>

          <!-- Section 3 - Add-ons -->
          <div class="card" data-section="3">
            <div class="card-header">
              <div class="card-title">
                <div class="card-step" data-step-indicator="3">3</div>
                Add-ons
              </div>
              <div class="card-status" data-step-status="3">
                Locked until previous step
              </div>
            </div>
            <div class="section-body hidden" data-section-body="3">
              <!-- Add-ons block (traveler view; data to be wired in next steps) -->
              <div class="addons-block">
                <div class="addons-header">
                  <div class="addons-title">Add-ons</div>
                  <div class="addons-subtitle">
                    Optional activities and extras selected by your hotel.
                  </div>
                </div>
                <div id="addonsList" class="addons-list">
                  <div class="muted" id="addonsEmptyMessage">
                    No add-ons are available for this stay.
                  </div>
                </div>
              </div>

              <button class="btn-primary" type="button" data-confirm="3">
                Confirm add-ons
              </button>
            </div>
          </div>

          <!-- Section 4 - Guest details -->
          <div class="card" data-section="4">
            <div class="card-header">
              <div class="card-title">
                <div class="card-step" data-step-indicator="4">4</div>
                Guest details
              </div>
              <div class="card-status" data-step-status="4">
                Locked until previous step
              </div>
            </div>
            <div class="section-body hidden" data-section-body="4">
              <div class="guest-form-grid">
                <div>
                  <label for="firstName">First name</label>
                  <input id="firstName" autocomplete="given-name" />
                </div>
                <div>
                  <label for="lastName">Last name</label>
                  <input id="lastName" autocomplete="family-name" />
                </div>
                <div>
                  <label for="email">Email</label>
                  <input id="email" type="email" autocomplete="email" />
                </div>
                <div>
                  <label for="phone">Mobile number</label>
                  <div class="phone-row">
                    <select id="phoneCountry" class="phone-country">
                      <option value="+1">ðŸ‡ºðŸ‡¸ +1 (United States)</option>
                      <option value="+63">ðŸ‡µðŸ‡­ +63 (Philippines)</option>
                      <option value="+44">+44 (United Kingdom)</option>
                      <option value="+61">+61 (Australia)</option>
                      <option value="+65">+65 (Singapore)</option>
                      <option value="+81">+81 (Japan)</option>
                      <option value="+82">+82 (South Korea)</option>
                      <option value="+49">+49 (Germany)</option>
                      <option value="+33">+33 (France)</option>
                      <option value="+34">+34 (Spain)</option>
                      <option value="+39">+39 (Italy)</option>
                      <option value="+31">+31 (Netherlands)</option>
                      <option value="+63-other">Other</option>
                    </select>
                    <input
                      id="phone"
                      type="tel"
                      autocomplete="tel"
                      placeholder="9-digit mobile"
                      class="phone-input"
                    />
                  </div>
                </div>
              </div>

              <div style="margin-top: 10px;">
                <label for="specialRequests">
                  Special request to hotel management (optional)
                </label>
                <textarea id="specialRequests"></textarea>
              </div>

              <div class="error-text" id="guestError" style="display: none;">
                Please fill in all guest details and contact information.
              </div>

              <button class="btn-primary" type="button" data-confirm="4">
                Confirm guest details
              </button>
            </div>
          </div>

          <!-- Section 5 - Payment method -->
          <div class="card" data-section="5">
            <div class="card-header">
              <div class="card-title">
                <div class="card-step" data-step-indicator="5">5</div>
                Payment method
              </div>
              <div class="card-status" data-step-status="4">
                Locked until previous step
              </div>
            </div>

            <div class="section-body hidden" data-section-body="4">
              <div class="field-row">

                <!-- TOP ROW: PAYMENT PILLS -->
                <div class="field-inline payment-options-row">
                  <!-- CARD / STRIPE -->
                  <div class="pill-wrap">
                    <div class="pill-caption">
                      Stripe â€“ Major CCs
                    </div>
                    <label class="pill-wrap-label">
                      <input
                        type="radio"
                        name="paymentMethod"
                        value="card"
                        class="payment-pill-input"
                        checked
                      />
                      <div class="pill">
                        <div class="pill-main">
                          <div class="card-logos">
														<img
															src="https://www.lolaelo.com/assets/card_visa.png"
															alt="Visa, Mastercard, Apple Pay, Discover, Amex"
															class="card-logo-ticker"
														/>
                          </div>
                        </div>
                      </div>
                    </label>
                  </div>

                  <!-- PAYPAL -->
                  <div class="pill-wrap">
                    <div class="pill-caption">
                      (coming soon)
                    </div>
                    <label class="pill-wrap-label">
                      <input
                        type="radio"
                        name="paymentMethod"
                        value="paypal"
                        class="payment-pill-input"
                        disabled
                      />
                      <div class="pill">
                        <div class="pill-main">
                          <img
                            src="https://www.lolaelo.com/assets/paypal.png"
                            alt="PayPal"
                          >
                        </div>
                      </div>
                    </label>
                  </div>

                  <!-- GCASH -->
                  <div class="pill-wrap">
                    <div class="pill-caption">
                      (coming soon)
                    </div>
                    <label class="pill-wrap-label">
                      <input
                        type="radio"
                        name="paymentMethod"
                        value="gcash"
                        class="payment-pill-input"
                        disabled
                      />
                      <div class="pill">
                        <div class="pill-main">
                          <img
                            src="https://www.lolaelo.com/assets/gcash.png"
                            alt="GCash"
                          >
                        </div>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- BOTTOM ROW: TEXT CAPTIONS UNDER PILLS -->
                <div class="field-inline payment-options-row" style="margin-top: 6px;">
                  <div style="min-width:190px;text-align:center;font-size:12px;color:#6b7280;">
                    <div>Visa â€“ MasterCard â€“ AMEX</div>
                    <div>ApplePay â€“ Discover</div>
                  </div>
                  <div style="min-width:190px;text-align:center;font-size:12px;color:#6b7280;">
                    PayPal
                  </div>
                  <div style="min-width:190px;text-align:center;font-size:12px;color:#6b7280;">
                    GCash
                  </div>
                </div>
              </div>

							<!-- SECURITY ICON + CONFIRM BUTTON (SIDE BY SIDE) -->
							<div style="display:flex; align-items:center; justify-content:flex-start; gap:14px; margin-top:16px; position:relative;">

                <!-- Confirm button -->
                <button class="btn-primary" type="button" data-confirm="5">
                  Proceed to secure payment
                </button>

								<!-- Security icon + bubble -->
								<div class="payment-security" style="position:relative;">
									<button
										class="security-icon-btn"
										type="button"
										aria-label="Security and payments"
									>
										ðŸ”’
									</button>

									<div class="security-bubble">
										<strong>Secure checkout</strong>
										Your payment is encrypted and processed by Stripe, the same
										provider trusted by companies like Lyft and Airbnb.
										Future options like PayPal and GCash will follow the same
										security standards so your card details never touch our servers.
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Right side: booking summary -->
        <aside>

          <div class="card">
            <div class="summary-card-title">Your stay</div>

            <div class="summary-line">
              <span>Property name</span>
              <strong id="summaryProperty">Property</strong>
            </div>

            <div class="summary-line">
              <span>Room type</span>
              <strong id="summaryRoom">Room</strong>
            </div>

            <div class="summary-line">
              <span>Rate plan</span>
              <strong id="summaryPlan">Rate plan</strong>
            </div>

            <div class="summary-line">
              <span>Dates</span>
              <strong id="summaryDates">Dates</strong>
            </div>

            <div class="summary-line">
              <span>Nights</span>
              <strong id="summaryNights">n</strong>
            </div>

            <div class="summary-line">
              <span>Add-ons</span>
              <strong id="summaryAddons">None selected</strong>
            </div>

            <div class="summary-total">
              <div>
                <div class="summary-total-label">Total</div>
              </div>
              <div class="summary-total-amount" id="summaryTotal">
                $50.00
              </div>
            </div>

            <div class="breakdown-toggle" id="breakdownToggle">
              View nightly breakdown
            </div>
            <div class="breakdown" id="breakdownDetails">
            </div>

          </div>

        </aside>

      <div class="sticky-footer">
        <div class="sticky-inner">
          <div>

          </div>
            <button class="sticky-button" id="confirmAndPayButton" disabled>
              Proceed to secure payment
            </button>
        </div>
      </div>
    </main>
  </div>

  <script>
    function parseQuery() {
      const params = new URLSearchParams(window.location.search);

      return {
        propertyId: params.get("propertyId") || "",
        roomId: params.get("roomId") || "",
        start: params.get("start") || "",
        end: params.get("end") || "",

        // IDs
        ratePlanId: params.get("ratePlanId") || params.get("plan") || "",

        // Optional name fields (can be populated from catalog_details)
        propertyName: params.get("propertyName") || "",
        propertyLocation: params.get("propertyLocation") || "",
        roomName: params.get("roomName") || "",

        // Rate plan display name â€“ prefer explicit name, fall back to planLabel
        ratePlanName:
          params.get("ratePlanName") ||
          params.get("planLabel") ||
          ""
      };
    }

    function formatDate(dateStr) {
      if (!dateStr) return "";
      const dt = new Date(dateStr);
      if (Number.isNaN(dt.getTime())) return dateStr;
      return dt.toLocaleDateString(undefined, {
        month: "short",
        day: "numeric",
        year: "numeric"
      });
    }

    function diffNights(startStr, endStr) {
      if (!startStr || !endStr) return "";
      const s = new Date(startStr);
      const e = new Date(endStr);
      if (Number.isNaN(s.getTime()) || Number.isNaN(e.getTime())) return "";
      const ms = e.getTime() - s.getTime();
      const nights = Math.round(ms / (1000 * 60 * 60 * 24));
      return nights > 0 ? nights : "";
    }

    function renderAddons(addons) {
      const listEl = document.getElementById("addonsList");
      const emptyEl = document.getElementById("addonsEmptyMessage");
      if (!listEl) return;

      listEl.innerHTML = "";

      const rows = Array.isArray(addons) ? addons : [];
      if (!rows.length) {
        if (emptyEl) {
          emptyEl.textContent = "No add-ons are available for this stay.";
          listEl.appendChild(emptyEl);
        }
        return;
      }

      // header row
      const header = document.createElement("div");
      header.className = "addon-row";
      header.style.fontWeight = "600";

      const hMain = document.createElement("div");
      hMain.className = "addon-main";
      const hTitle = document.createElement("div");
      hTitle.className = "addon-title";
      hTitle.textContent = "Activity";
      const hMeta = document.createElement("div");
      hMeta.className = "addon-meta";
      hMeta.textContent = "Price Â· Unit Â· Hotel notes";
      hMain.appendChild(hTitle);
      hMain.appendChild(hMeta);

      const hQty = document.createElement("div");
      hQty.className = "addon-qty";
      const hQtyLabel = document.createElement("span");
      hQtyLabel.textContent = "Qty";
      hQty.appendChild(hQtyLabel);

      header.appendChild(hMain);
      header.appendChild(hQty);

      listEl.appendChild(header);

      rows.forEach(function (item, idx) {
        const activity = (item.activity || "").toString().trim() || "Add-on";
        const uom = (item.uom || "").toString().trim();
        const rawPrice = item.price;
        const notes = (item.notes || "").toString().trim();

        const price =
          typeof rawPrice === "number"
            ? rawPrice
            : (rawPrice != null ? Number(rawPrice) : NaN);

        let priceText = "";
        if (!Number.isNaN(price) && Number.isFinite(price)) {
          try {
            priceText = price.toLocaleString(undefined, {
              style: "currency",
              currency: "USD"
            });
          } catch (e) {
            priceText = "$" + price.toFixed(2);
          }
        }

        const metaParts = [];
        if (priceText) metaParts.push(priceText);
        if (uom) metaParts.push(uom);
        if (notes) metaParts.push(notes);
        const metaText = metaParts.join(" Â· ");

        const row = document.createElement("div");
        row.className = "addon-row";

        const main = document.createElement("div");
        main.className = "addon-main";

        const titleEl = document.createElement("div");
        titleEl.className = "addon-title";
        titleEl.textContent = activity;

        const metaEl = document.createElement("div");
        metaEl.className = "addon-meta";
        metaEl.textContent = metaText;

        main.appendChild(titleEl);
        main.appendChild(metaEl);

        const qtyWrap = document.createElement("div");
        qtyWrap.className = "addon-qty";

        const qtyLabel = document.createElement("label");
        qtyLabel.textContent = "Qty";

        const qtyInput = document.createElement("input");
        qtyInput.type = "number";
        qtyInput.min = "0";
        qtyInput.step = "1";
        qtyInput.value = "0";
        qtyInput.setAttribute("data-addon-index", String(idx));

        qtyWrap.appendChild(qtyLabel);
        qtyWrap.appendChild(qtyInput);

        row.appendChild(main);
        row.appendChild(qtyWrap);

        // Traveler comment field under each row
        const comment = document.createElement("textarea");
        comment.rows = 2;
        comment.placeholder = "Comments for hotel (optional)";
        comment.className = "addon-comment";
        comment.setAttribute("data-addon-index", String(idx));

        const wrapper = document.createElement("div");
        wrapper.style.display = "flex";
        wrapper.style.flexDirection = "column";
        wrapper.style.gap = "4px";

        wrapper.appendChild(row);
        wrapper.appendChild(comment);

        listEl.appendChild(wrapper);
      });
    }

    async function loadAddonsForProperty() {
      if (!state.propertyId) return;

      try {
        const params = new URLSearchParams();
        params.set("propertyId", state.propertyId);
        if (state.start) params.set("start", state.start);
        if (state.end) params.set("end", state.end);

        const resp = await fetch("/catalog/details?" + params.toString(), {
          method: "GET",
          headers: { Accept: "application/json" }
        });

        if (!resp.ok) {
          throw new Error("Failed to load add-ons for property " + state.propertyId);
        }

        const data = await resp.json();
        const addons = Array.isArray(data.addons) ? data.addons : [];
        state.addonsConfig = addons;
        renderAddons(addons);
      } catch (err) {
        console.error("Error loading add-ons", err);
        state.addonsConfig = [];
        renderAddons([]);
      }
    }

    function recomputeSelectedAddons() {
      const listEl = document.getElementById("addonsList");
      if (!listEl) return;

      const qtyInputs = listEl.querySelectorAll(
        'input[type="number"][data-addon-index]'
      );
      const commentAreas = listEl.querySelectorAll(
        'textarea.addon-comment[data-addon-index]'
      );

      const commentsByIndex = {};
      commentAreas.forEach(function (ta) {
        const idxAttr = ta.getAttribute("data-addon-index");
        const idx = Number(idxAttr);
        if (!Number.isFinite(idx) || idx < 0) return;
        commentsByIndex[idx] = ta.value || "";
      });

      const selections = [];

      qtyInputs.forEach(function (input) {
        const idxAttr = input.getAttribute("data-addon-index");
        const idx = Number(idxAttr);
        if (!Number.isFinite(idx) || idx < 0) return;

        const qty = Number(input.value || "0");
        if (!Number.isFinite(qty) || qty <= 0) return;

        const cfg = Array.isArray(state.addonsConfig)
          ? state.addonsConfig[idx]
          : null;
        if (!cfg) return;

        const rawPrice = cfg.price;
        const price =
          typeof rawPrice === "number"
            ? rawPrice
            : (rawPrice != null ? Number(rawPrice) : NaN);

        const lineTotal =
          !Number.isNaN(price) && Number.isFinite(price)
            ? price * qty
            : null;

        selections.push({
          index: idx,
          quantity: qty,
          activity: (cfg.activity || "").toString().trim(),
          uom: (cfg.uom || "").toString().trim(),
          price: !Number.isNaN(price) && Number.isFinite(price) ? price : null,
          lineTotal,
          travelerComment: commentsByIndex[idx] || ""
        });
      });

      state.selectedAddons = selections;
      updateSummaries();
    }

    const state = {
      propertyId: "",
      roomId: "",
      start: "",
      end: "",
      ratePlanId: "",
      propertyName: "",
      propertyLocation: "",
      roomName: "",
      ratePlanName: "",
      sectionConfirmed: { 1: false, 2: false, 3: false, 4: false },
      addonsConfig: [],
      addonsSelections: {}
    };

    function updateSummaries() {
      const propertyText =
        state.propertyName || state.propertyId || "Property";
      const propertyMeta = state.propertyLocation || "";
      const roomText =
        state.roomName || state.roomId || "Room";
      const planText =
        state.ratePlanName || state.ratePlanId || "Rate plan";

      // Hidden IDs (for debugging / future logic)
      const propIdEl = document.getElementById("propertyIdValue");
      if (propIdEl) propIdEl.textContent = state.propertyId;
      const roomIdEl = document.getElementById("roomIdValue");
      if (roomIdEl) roomIdEl.textContent = state.roomId;
      const planIdEl = document.getElementById("ratePlanIdValue");
      if (planIdEl) planIdEl.textContent = state.ratePlanId;

      // Visible labels in Section 1
      const propNameEl = document.getElementById("propertyName");
      if (propNameEl) propNameEl.textContent = propertyText;
      const propMetaEl = document.getElementById("propertyMeta");
      if (propMetaEl) propMetaEl.textContent = propertyMeta;

      const roomNameEl = document.getElementById("roomName");
      if (roomNameEl) roomNameEl.textContent = roomText;
      const planNameEl = document.getElementById("ratePlanName");
      if (planNameEl) planNameEl.textContent = planText;

      // Summary card on the right
      document.getElementById("summaryProperty").textContent = propertyText;
      document.getElementById("summaryRoom").textContent = roomText;
      document.getElementById("summaryPlan").textContent = planText;

      const startFormatted = formatDate(state.start);
      const endFormatted = formatDate(state.end);
      const nights = diffNights(state.start, state.end);
            const datesText =
        startFormatted && endFormatted
          ? startFormatted + " to " + endFormatted
          : "Dates";
      document.getElementById("stayDatesText").textContent = datesText;
      document.getElementById("summaryDates").textContent = datesText;
      const nightsText =
        nights ? nights + " night" + (nights > 1 ? "s" : "") : "";
      const nightsNum =
        typeof nights === "number" ? nights : Number(nights) || 0;

      document.getElementById("nightsCountText").textContent =
        nightsText || "nights";
      document.getElementById("summaryNights").textContent =
        nightsText || "n";

      // Price per night in Section 2
      const nightlyEl = document.getElementById("nightlyPriceText");
      if (nightlyEl) {
        const totalEl = document.getElementById("summaryTotal");
        const raw = totalEl ? totalEl.textContent || "" : "";
        const num = Number(String(raw).replace(/[^0-9.]/g, ""));

        if (!Number.isNaN(num) && nightsNum > 0) {
          const perNight = num / nightsNum;
          nightlyEl.textContent = "$" + perNight.toFixed(2);
        } else {
          nightlyEl.textContent = "-";
        }
      }

      // Add-ons summary
      var addonsLabel = "None selected";
      if (Array.isArray(state.selectedAddons) && state.selectedAddons.length) {
        var totalQty = state.selectedAddons.reduce(function (sum, item) {
          var q = Number(item.quantity || 0);
          return sum + (Number.isFinite(q) && q > 0 ? q : 0);
        }, 0);
        if (totalQty > 0) {
          addonsLabel =
            totalQty +
            " add-on" +
            (totalQty === 1 ? "" : "s");
        }
      }
      var addonsEl = document.getElementById("summaryAddons");
      if (addonsEl) addonsEl.textContent = addonsLabel;
    }

        function updateAddonsSummary() {
      // Count how many distinct add-ons have qty > 0
      const selections = state.addonsSelections || {};
      const selectedCount = Object.values(selections).reduce((acc, qty) => {
        const n = typeof qty === "number" ? qty : parseInt(qty, 10);
        return acc + (n > 0 ? 1 : 0);
      }, 0);

      const summaryEl = document.getElementById("summaryAddons");
      if (summaryEl) {
        summaryEl.textContent =
          selectedCount > 0
            ? selectedCount + " add-on" + (selectedCount > 1 ? "s" : "") + " selected"
            : "None selected";
      }
    }

    function renderAddons(addons) {
      const listEl = document.getElementById("addonsList");
      const emptyEl = document.getElementById("addonsEmptyMessage");
      if (!listEl) return;

      state.addonsConfig = Array.isArray(addons) ? addons : [];
      if (!state.addonsSelections) state.addonsSelections = {};

      // Reset list
      listEl.innerHTML = "";

      const rows = state.addonsConfig;
      if (!rows || rows.length === 0) {
        if (emptyEl) {
          emptyEl.style.display = "block";
          listEl.appendChild(emptyEl);
        }
        updateAddonsSummary();
        return;
      }

      if (emptyEl) {
        emptyEl.style.display = "none";
      }

      rows.forEach((addon, index) => {
        const key = addon.id != null ? String(addon.id) : "idx-" + index;
        const currentQty = state.addonsSelections[key] || 0;

        const row = document.createElement("div");
        row.className = "addon-row";

        const main = document.createElement("div");
        main.className = "addon-main";

        const nameEl = document.createElement("div");
        nameEl.className = "addon-name";
        nameEl.textContent = addon.activity || "Activity";

        const metaEl = document.createElement("div");
        metaEl.className = "addon-meta";

        const parts = [];
        if (addon.uom) parts.push(String(addon.uom));
        if (typeof addon.price === "number") {
          parts.push(
            "$" + addon.price.toFixed(2) +
            (addon.uom ? " per " + String(addon.uom).toLowerCase() : "")
          );
        }
        metaEl.textContent = parts.join(" â€¢ ");

        if (addon.notes) {
          const notesEl = document.createElement("div");
          notesEl.className = "addon-notes";
          notesEl.textContent = addon.notes;
          main.appendChild(notesEl);
        }

        main.appendChild(nameEl);
        main.appendChild(metaEl);

        const qtyWrap = document.createElement("div");
        qtyWrap.className = "addon-qty";

        const qtyLabel = document.createElement("label");
        qtyLabel.textContent = "Qty";

        const qtyInput = document.createElement("input");
        qtyInput.type = "number";
        qtyInput.min = "0";
        qtyInput.step = "1";
        qtyInput.value =
          typeof currentQty === "number" && currentQty > 0 ? String(currentQty) : "0";

        qtyInput.addEventListener("input", function () {
          const val = parseInt(qtyInput.value, 10);
          if (isNaN(val) || val <= 0) {
            delete state.addonsSelections[key];
          } else {
            state.addonsSelections[key] = val;
          }
          updateAddonsSummary();
        });

        qtyWrap.appendChild(qtyLabel);
        qtyWrap.appendChild(qtyInput);

        row.appendChild(main);
        row.appendChild(qtyWrap);

        listEl.appendChild(row);
      });

      updateAddonsSummary();
    }

    async function loadAddonsForProperty() {
      if (!state.propertyId) {
        console.log("[checkout] loadAddonsForProperty skipped â€“ no propertyId");
        return;
      }

      try {
        const params = new URLSearchParams();
        params.set("propertyId", state.propertyId);
        if (state.start) params.set("start", state.start);
        if (state.end) params.set("end", state.end);

        const resp = await fetch("/catalog/details?" + params.toString(), {
          headers: { Accept: "application/json" }
        });

        if (!resp.ok) {
          console.warn(
            "[checkout] /catalog/details for addons failed",
            resp.status
          );
          return;
        }

        const data = await resp.json();
        const addons = Array.isArray(data.addons) ? data.addons : [];
        console.log("[checkout] addons from details", addons);
        renderAddons(addons);
      } catch (err) {
        console.error("[checkout] loadAddonsForProperty error", err);
      }
    }

    async function loadAddonsConfig() {
      if (!state.propertyId || !state.start || !state.end) {
        console.log("[checkout] loadAddonsConfig skipped (missing ids/dates)", {
          propertyId: state.propertyId,
          start: state.start,
          end: state.end
        });
        return;
      }

      try {
        const params = new URLSearchParams();
        params.set("propertyId", state.propertyId);
        params.set("start", state.start);
        params.set("end", state.end);
        if (state.ratePlanId) params.set("ratePlanId", state.ratePlanId);

        const resp = await fetch("/catalog/details?" + params.toString(), {
          headers: { Accept: "application/json" }
        });

        if (!resp.ok) {
          console.warn("[checkout] /catalog/details for addons failed", resp.status);
          return;
        }

        const data = await resp.json();
        const addons = Array.isArray(data.addons) ? data.addons : [];
        state.addonsConfig = addons;
        console.log("[checkout] addons config from details", addons);
        // UI wiring for traveler selections will be added in the next step.
      } catch (err) {
        console.error("[checkout] loadAddonsConfig error", err);
      }
    }

    function setSectionState(section, status) {
      const stepCircle = document.querySelector('[data-step-indicator="' + section + '"]');
      const statusLabel = document.querySelector('[data-step-status="' + section + '"]');
      const body = document.querySelector('[data-section-body="' + section + '"]');
      if (!stepCircle || !statusLabel || !body) return;

      if (status === "active") {
        stepCircle.classList.add("active");
        stepCircle.classList.remove("completed");
        statusLabel.textContent = "Waiting for confirmation";
        statusLabel.classList.remove("completed");
        body.classList.remove("hidden");
      } else if (status === "completed") {
        stepCircle.classList.remove("active");
        stepCircle.classList.add("completed");
        statusLabel.textContent = "Confirmed";
        statusLabel.classList.add("completed");
        body.classList.add("hidden");
      } else {
        stepCircle.classList.remove("active");
        stepCircle.classList.remove("completed");
        statusLabel.textContent = "Locked until previous step";
        statusLabel.classList.remove("completed");
        body.classList.add("hidden");
      }
    }

    function refreshSections() {
      for (let i = 1; i <= 5; i++) {
        const isConfirmed = state.sectionConfirmed[i];
        if (i === 1) {
          setSectionState(1, isConfirmed ? "completed" : "active");
        } else {
          const prevDone = state.sectionConfirmed[i - 1];
          if (!prevDone) {
            setSectionState(i, "locked");
          } else {
            setSectionState(i, isConfirmed ? "completed" : "active");
          }
        }
      }
      const allConfirmed =
        state.sectionConfirmed[1] &&
        state.sectionConfirmed[2] &&
        state.sectionConfirmed[3] &&
        state.sectionConfirmed[4] &&
        state.sectionConfirmed[5];
      document.getElementById("confirmAndPayButton").disabled = !allConfirmed;
    }

    function handleConfirmClick(section) {
      // Guest details validation now lives on section 4
      if (section === 4) {
        const firstName = document.getElementById("firstName").value.trim();
        const lastName = document.getElementById("lastName").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const errorEl = document.getElementById("guestError");

        if (!firstName || !lastName || !email || !phone) {
          if (errorEl) errorEl.style.display = "block";
          return;
        } else if (errorEl) {
          errorEl.style.display = "none";
        }
      }

      state.sectionConfirmed[section] = true;
      refreshSections();
    }

    function initCheckout() {
      const q = parseQuery();
      state.propertyId = q.propertyId;
      state.roomId = q.roomId;
      state.start = q.start;
      state.end = q.end;
      state.ratePlanId = q.ratePlanId;
      state.propertyName = q.propertyName;
      state.propertyLocation = q.propertyLocation;
      state.roomName = q.roomName;
      state.ratePlanName = q.ratePlanName;

      updateSummaries();
      refreshSections();
      loadAddonsForProperty();

      // Allow clicking headers to reopen a section, but keep only one open

      // Allow clicking headers to reopen a section, but keep only one open
      document.querySelectorAll(".card-header").forEach(function (header) {
        header.addEventListener("click", function () {
          var card = header.closest(".card");
          if (!card) return;
          var section = Number(card.getAttribute("data-section"));
          if (!section) return;

          // Donâ€™t let user jump ahead if previous sections arenâ€™t confirmed
          for (var i = 1; i < section; i++) {
            if (!state.sectionConfirmed[i]) {
              return;
            }
          }

          // Open this section, close all others
          document.querySelectorAll("[data-section-body]").forEach(function (bodyEl) {
            var bodySection = Number(bodyEl.getAttribute("data-section-body"));
            if (bodySection === section) {
              bodyEl.classList.remove("hidden");
            } else {
              bodyEl.classList.add("hidden");
            }
          });
        });
      });

      document.querySelectorAll("[data-confirm]").forEach(function (btn) {
        btn.addEventListener("click", function () {
          const section = Number(btn.getAttribute("data-confirm"));
          handleConfirmClick(section);
        });
      });

      const breakdownToggle = document.getElementById("breakdownToggle");
      const breakdownDetails = document.getElementById("breakdownDetails");
      if (breakdownToggle && breakdownDetails) {
        breakdownToggle.addEventListener("click", function () {
          breakdownDetails.classList.toggle("visible");
        });
      }

      const confirmAndPayButton = document.getElementById("confirmAndPayButton");
      if (confirmAndPayButton) {
        confirmAndPayButton.addEventListener("click", async function () {
          if (confirmAndPayButton.disabled) return;

          confirmAndPayButton.disabled = true;
          confirmAndPayButton.textContent = "Redirecting to secure payment...";

          try {
            const response = await fetch("/api/payments/create-checkout-session", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                propertyId: state.propertyId,
                roomId: state.roomId,
                start: state.start,
                end: state.end,
                ratePlanId: state.ratePlanId,
                addons: Array.isArray(state.selectedAddons)
                  ? state.selectedAddons
                  : []
              })
            });

            if (!response.ok) throw new Error("Failed to start payment");
            const data = await response.json();
            if (data && data.url) {
              window.location.href = data.url;
            } else {
              throw new Error("Missing redirect URL");
            }
          } catch (err) {
            console.error("Error starting Stripe Checkout", err);
            confirmAndPayButton.disabled = false;
            confirmAndPayButton.textContent = "Proceed to secure payment";
            alert("Could not start payment. Please try again.");
          }
        });
      }

      const changePlanLink = document.getElementById("changePlanLink");
      if (changePlanLink) {
        changePlanLink.addEventListener("click", function () {
          window.history.back();
        });
      }

      // Date card wiring for Section 2
      const datesCardWrapper = document.getElementById("checkoutDatesCardWrapper");
      const checkInInput = document.getElementById("checkout-checkin");
      const checkOutInput = document.getElementById("checkout-checkout");
      const applyBtn = document.getElementById("checkout-dates-apply");

      // Initialize inputs from state/query
      if (checkInInput && checkOutInput) {
        try {
          checkInInput.value = state.start || "";
          checkOutInput.value = state.end || "";
        } catch (_) {
          // ignore
        }
      }

      const editDatesLink = document.getElementById("editDatesLink");
      if (editDatesLink && datesCardWrapper) {
        editDatesLink.addEventListener("click", function () {
          const visible = datesCardWrapper.style.display === "flex";
          datesCardWrapper.style.display = visible ? "none" : "flex";
        });
      }

      if (applyBtn && checkInInput && checkOutInput) {
        applyBtn.addEventListener("click", function () {
          const ci = checkInInput.value || state.start;
          const co = checkOutInput.value || state.end;
          if (!ci || !co) return;

          const ciDate = new Date(ci);
          const coDate = new Date(co);

          if (!Number.isNaN(ciDate) && !Number.isNaN(coDate) && coDate <= ciDate) {
            coDate.setDate(ciDate.getDate() + 1);
          }

          const finalStart = !Number.isNaN(ciDate)
            ? ciDate.toISOString().slice(0, 10)
            : ci;
          const finalEnd = !Number.isNaN(coDate)
            ? coDate.toISOString().slice(0, 10)
            : co;

          const qsNext = new URLSearchParams(location.search);
          qsNext.set("start", finalStart);
          qsNext.set("end", finalEnd);

          const nextUrl = `${location.pathname}?${qsNext.toString()}`;
          location.assign(nextUrl);
        });
      }
    }
    document.addEventListener("DOMContentLoaded", initCheckout);

      const addonsList = document.getElementById("addonsList");
      if (addonsList) {
        addonsList.addEventListener("input", function (ev) {
          const target = ev.target;
          if (!target) return;

          const isQty =
            target.tagName === "INPUT" &&
            target.getAttribute("type") === "number" &&
            target.getAttribute("data-addon-index") != null;

          const isComment =
            target.tagName === "TEXTAREA" &&
            target.classList.contains("addon-comment") &&
            target.getAttribute("data-addon-index") != null;

          if (!isQty && !isComment) return;

          recomputeSelectedAddons();
        });
      }
  </script>

	  <script>
    (function () {
      const tickerImg = document.querySelector(".card-logo-ticker");
      if (!tickerImg) return;

      // TODO: make sure these 5 files exist in /assets on lolaelo.com
      const logos = [
        "https://www.lolaelo.com/assets/card_visa.png",
        "https://www.lolaelo.com/assets/card_mastercard.png",
        "https://www.lolaelo.com/assets/card_applepay.png",
        "https://www.lolaelo.com/assets/card_discover.png",
        "https://www.lolaelo.com/assets/card_amex.png",
      ];

      let index = 0;
      setInterval(() => {
        index = (index + 1) % logos.length;
        tickerImg.src = logos[index];
      }, 1500);
    })();
  </script>

</body>
</html>
